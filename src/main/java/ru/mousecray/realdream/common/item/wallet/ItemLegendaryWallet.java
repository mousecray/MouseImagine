package ru.mousecray.realdream.common.item.wallet;

import mcp.MethodsReturnNonnullByDefault;
import net.minecraft.entity.EntityLivingBase;
import net.minecraft.item.ItemStack;
import net.minecraft.world.World;
import ru.mousecray.realdream.common.economy.CoinValue;
import ru.mousecray.realdream.common.economy.capacity.WalletCapacity;
import ru.mousecray.realdream.common.economy.wallet.WalletType;
import ru.mousecray.realdream.common.item.coin.ICoin;
import ru.mousecray.realdream.nbt.RealDreamNBT;
import ru.mousecray.realdream.utils.RDRandomUtils;

import javax.annotation.Nullable;
import javax.annotation.ParametersAreNonnullByDefault;
import java.util.Random;

@MethodsReturnNonnullByDefault
@ParametersAreNonnullByDefault
public class ItemLegendaryWallet extends ItemWallet {
    public ItemLegendaryWallet(WalletType type, WalletCapacity<?>... capacities) {
        super(type, null, null, capacities);
    }

    @Nullable @Override
    public CoinValue putCoin(World world, EntityLivingBase entity, ItemStack wallet, ItemStack coin) {
        CoinValue coinValue = super.putCoin(world, entity, wallet, coin);
        if (coinValue != null && coinValue.isNull()) {
            if (!world.isRemote) {
                if (!(coin.getItem() instanceof ICoin) || wallet.getItem() != this) return null;

                if (RealDreamNBT.get(coin).getCoinPipe().loadIsNew()) {
                    Random rand = entity.getRNG();
                    if (RDRandomUtils.normalChance(rand, 1)) {
                        super.putCoin(world, entity, wallet, coin.copy());
                    }
                }
            }
        }
        return coinValue;
    }

//    @Override
//    public CoinValue<?> putCoin(World world, EntityLiving entity, ItemStack wallet, ItemStack coin.json) {
//        super.putCoin(world, entity, wallet, coin.json);
//
//        //TODO: Кошелёк будет увеличивать полученные монеты в 2 раза с шансом в 1%
//    }
}